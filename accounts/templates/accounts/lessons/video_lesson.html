{% extends 'accounts/base.html' %}

{% block title %}{{ lesson.title }} - LMS{% endblock %}

{% block content %}
<div class="container mt-5">
    <a href="{% url 'profession_detail' profession.pk %}" class="btn btn-outline-secondary mb-4">
        <i class="bi bi-arrow-left me-2"></i>Orqaga
    </a>

    <div class="card">
        <div class="card-header" style="background: transparent; border-bottom: 1px solid var(--border-color);">
            <div class="d-flex justify-content-between align-items-center">
                <h4 style="color: var(--primary-blue); margin: 0;">
                    <i class="bi bi-play-circle me-2"></i>{{ lesson.title }}
                </h4>
                {% if progress.watched %}
                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Ko'rilgan</span>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <div class="ratio ratio-16x9 mb-4">
                <iframe src="{{ video.get_embed_url }}" title="{{ lesson.title }}" allowfullscreen 
                        style="border-radius: 15px;"></iframe>
            </div>
            
            {% if not progress.watched %}
            <div class="text-center">
                <button class="btn btn-success btn-lg" id="markWatched">
                    <i class="bi bi-check-circle me-2"></i>Videoni ko'rdim (+1 coin)
                </button>
            </div>
            {% else %}
            <div class="alert alert-success text-center">
                <i class="bi bi-check-circle me-2"></i>
                Siz bu videoni ko'rgansiz va 1 coin oldingiz!
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% block extra_js %}
<script>
document.getElementById('markWatched')?.addEventListener('click', function() {
    fetch('{% url "mark_video_watched" video.pk %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    }).then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
});
</script>
{% endblock %}
{% endblock %}
