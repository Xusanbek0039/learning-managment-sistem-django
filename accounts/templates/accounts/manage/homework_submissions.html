{% extends 'accounts/admin/base_admin.html' %}

{% block title %}Uy vazifalari{% endblock %}

{% block extra_css %}
<style>
:root {
    --card-bg: #fff;
    --border: #e5e7eb;
    --text-dark: #1f2937;
    --text-muted: #6b7280;
    --soft-bg: #f8fafc;
}
[data-bs-theme="dark"] {
    --card-bg: #1e1e2d;
    --border: #2d2d3a;
    --text-dark: #e5e7eb;
    --text-muted: #9ca3af;
    --soft-bg: #151521;
}

.stat-chips {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}
.stat-chip {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    border: 1px solid var(--border);
    background: var(--card-bg);
    color: var(--text-dark);
}
.stat-chip:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.stat-chip.active { background: #8b5cf6; color: #fff; border-color: #8b5cf6; }
.stat-chip .num { 
    display: inline-flex; 
    align-items: center; 
    justify-content: center;
    min-width: 20px;
    height: 20px;
    background: rgba(0,0,0,0.1); 
    border-radius: 10px; 
    margin-left: 6px;
    font-size: 0.7rem;
}
.stat-chip.active .num { background: rgba(255,255,255,0.25); }

.filter-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}
.filter-row select {
    padding: 8px 14px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--card-bg);
    color: var(--text-dark);
    font-size: 0.85rem;
}

.card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
}

.sub-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 16px;
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
}
.sub-item:last-child { border-bottom: none; }
.sub-item:hover { background: var(--soft-bg); }

.sub-avatar {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
    color: #fff;
    flex-shrink: 0;
}
.sub-avatar img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
.sub-avatar.pending { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
.sub-avatar.reviewing { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
.sub-avatar.revision { background: linear-gradient(135deg, #ef4444, #f87171); }
.sub-avatar.accepted { background: linear-gradient(135deg, #10b981, #34d399); }
.sub-avatar.graded { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }

.sub-info { flex: 1; min-width: 0; }
.sub-info h6 { margin: 0; font-size: 0.9rem; font-weight: 600; color: var(--text-dark); }
.sub-info p { margin: 3px 0 0; font-size: 0.75rem; color: var(--text-muted); }

.sub-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
    flex-shrink: 0;
}
.status-badge {
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}
.status-badge.pending { background: rgba(245,158,11,0.12); color: #d97706; }
.status-badge.reviewing { background: rgba(59,130,246,0.12); color: #2563eb; }
.status-badge.revision { background: rgba(239,68,68,0.12); color: #dc2626; }
.status-badge.accepted { background: rgba(16,185,129,0.12); color: #059669; }
.status-badge.graded { background: rgba(139,92,246,0.12); color: #7c3aed; }

.time-ago { font-size: 0.7rem; color: var(--text-muted); }

.msg-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    background: #ef4444;
    color: #fff;
    border-radius: 10px;
    font-size: 0.65rem;
    font-weight: 700;
}

.late-badge {
    background: rgba(239,68,68,0.12);
    color: #dc2626;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
}

.btn-view {
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    text-decoration: none;
    background: var(--soft-bg);
    color: var(--text-dark);
    border: 1px solid var(--border);
    transition: all 0.15s;
}
.btn-view:hover { background: #8b5cf6; color: #fff; border-color: #8b5cf6; }

.empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
.empty i { font-size: 3rem; opacity: 0.3; margin-bottom: 12px; display: block; }
</style>
{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0 fw-bold"><i class="bi bi-journal-text text-primary me-2"></i>Uy Vazifalari</h4>
</div>

<!-- Status Chips -->
<div class="stat-chips">
    <a href="{% url 'homework_submissions' %}" class="stat-chip {% if not status_filter %}active{% endif %}">
        Barchasi <span class="num">{{ stats.pending|add:stats.reviewing|add:stats.revision|add:stats.accepted }}</span>
    </a>
    <a href="?status=pending" class="stat-chip {% if status_filter == 'pending' %}active{% endif %}">
        ‚è≥ Kutilmoqda <span class="num">{{ stats.pending }}</span>
    </a>
    <a href="?status=reviewing" class="stat-chip {% if status_filter == 'reviewing' %}active{% endif %}">
        üëÄ Ko'rilmoqda <span class="num">{{ stats.reviewing }}</span>
    </a>
    <a href="?status=revision" class="stat-chip {% if status_filter == 'revision' %}active{% endif %}">
        üîÑ Qayta ishlash <span class="num">{{ stats.revision }}</span>
    </a>
    <a href="?status=accepted" class="stat-chip {% if status_filter == 'accepted' %}active{% endif %}">
        ‚úÖ Qabul qilingan <span class="num">{{ stats.accepted }}</span>
    </a>
    <a href="?status=graded" class="stat-chip {% if status_filter == 'graded' %}active{% endif %}">
        üìä Baholangan <span class="num">{{ stats.graded }}</span>
    </a>
</div>

<!-- Filter -->
<form method="GET" class="filter-row">
    {% if status_filter %}<input type="hidden" name="status" value="{{ status_filter }}">{% endif %}
    <select name="profession" onchange="this.form.submit()">
        <option value="">Barcha kurslar</option>
        {% for p in professions %}
        <option value="{{ p.pk }}" {% if profession_filter == p.pk|stringformat:"i" %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
    </select>
</form>

<!-- Submissions List -->
<div class="card">
    {% if submissions %}
    {% for sub in submissions %}
    <div class="sub-item">
        <div class="sub-avatar {{ sub.status }}">
            {% if sub.student.photo %}
            <img src="{{ sub.student.photo.url }}" alt="">
            {% else %}
            {{ sub.student.get_initials }}
            {% endif %}
        </div>
        
        <div class="sub-info">
            <h6>
                {{ sub.student.full_name }}
                {% if sub.messages.count > 0 %}
                <span class="msg-badge"><i class="bi bi-chat-dots"></i> {{ sub.messages.count }}</span>
                {% endif %}
                {% if sub.is_late %}
                <span class="late-badge">KECH</span>
                {% endif %}
            </h6>
            <p>
                <i class="bi bi-journal me-1"></i>{{ sub.homework.lesson.title }}
                <span class="mx-1">‚Ä¢</span>
                <i class="bi bi-folder me-1"></i>{{ sub.homework.lesson.profession.name }}
                {% if sub.revision_count > 0 %}
                <span class="mx-1">‚Ä¢</span>
                <span class="text-warning"><i class="bi bi-arrow-repeat me-1"></i>{{ sub.revision_count }}x qayta</span>
                {% endif %}
            </p>
        </div>
        
        <div class="sub-meta">
            <span class="status-badge {{ sub.status }}">
                {% if sub.status == 'pending' %}Kutilmoqda
                {% elif sub.status == 'reviewing' %}Ko'rilmoqda
                {% elif sub.status == 'revision' %}Qayta ishlash
                {% elif sub.status == 'accepted' %}Qabul qilindi
                {% elif sub.status == 'graded' %}{{ sub.grade }}%
                {% endif %}
            </span>
            <span class="time-ago">{{ sub.submitted_at|timesince }} oldin</span>
        </div>
        
        <a href="{% url 'grade_homework' sub.pk %}" class="btn-view">
            <i class="bi bi-eye me-1"></i>Ko'rish
        </a>
    </div>
    {% endfor %}
    {% else %}
    <div class="empty">
        <i class="bi bi-inbox"></i>
        <p>Vazifalar yo'q</p>
    </div>
    {% endif %}
</div>
{% endblock %}
