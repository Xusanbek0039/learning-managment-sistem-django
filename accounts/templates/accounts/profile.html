{% extends 'accounts/base.html' %}

{% block title %}Profil - LMS{% endblock %}

{% block content %}
<div class="container mt-5">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card text-center p-4">
                <div class="mb-3">
                    {% if user.photo %}
                        <img src="{{ user.photo.url }}" alt="{{ user.full_name }}" 
                             style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary-blue);">
                    {% else %}
                        <div style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); display: flex; align-items: center; justify-content: center; margin: 0 auto; font-size: 3rem; color: white; font-weight: 700;">
                            {{ user.get_initials }}
                        </div>
                    {% endif %}
                </div>
                <h4 style="color: var(--text-color);">{{ user.full_name }}</h4>
                <p style="color: #6c757d;">@{{ user.username }}</p>
                <span class="role-badge role-{{ user.role }} mb-3">
                    {% if user.role == 'admin' %}Admin{% elif user.role == 'teacher' %}O'qituvchi{% else %}O'quvchi{% endif %}
                </span>
                
                <div class="d-grid gap-2 mt-3">
                    <a href="{% url 'profile_edit' %}" class="btn btn-primary">
                        <i class="bi bi-pencil me-2"></i>Tahrirlash
                    </a>
                    <a href="{% url 'change_password' %}" class="btn btn-outline-primary">
                        <i class="bi bi-key me-2"></i>Parolni o'zgartirish
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card p-4">
                <h5 style="color: var(--primary-blue); margin-bottom: 20px;">
                    <i class="bi bi-person-lines-fill me-2"></i>Profil ma'lumotlari
                </h5>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Ism</label>
                        <p style="color: var(--text-color); font-weight: 500;">{{ user.first_name }}</p>
                    </div>
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Familiya</label>
                        <p style="color: var(--text-color); font-weight: 500;">{{ user.last_name }}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Username</label>
                        <p style="color: var(--text-color); font-weight: 500;">{{ user.username }}</p>
                    </div>
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Telefon</label>
                        <p style="color: var(--text-color); font-weight: 500;">{{ user.phone }}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Yo'nalish</label>
                        <p style="color: var(--text-color); font-weight: 500;">
                            {% if user.profession %}{{ user.profession.name }}{% else %}<span class="text-muted">Tanlanmagan</span>{% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Ro'yxatdan o'tgan</label>
                        <p style="color: var(--text-color); font-weight: 500;">{{ user.date_joined|date:"d.m.Y" }}</p>
                    </div>
                </div>
                
                {% if user.bio %}
                <div class="mb-3">
                    <label style="color: #6c757d; font-size: 0.85rem;">O'zi haqida</label>
                    <p style="color: var(--text-color);">{{ user.bio }}</p>
                </div>
                {% endif %}
                
                <hr>
                
                <div class="row">
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Oxirgi faollik</label>
                        <p style="color: var(--text-color); font-weight: 500;">
                            {% if user.last_activity %}
                                {{ user.last_activity|date:"d.m.Y H:i" }}
                                {% if user.is_online %}
                                    <span class="badge bg-success ms-2">Online</span>
                                {% endif %}
                            {% else %}
                                <span class="text-muted">Ma'lumot yo'q</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <label style="color: #6c757d; font-size: 0.85rem;">Status</label>
                        <p>
                            {% if user.is_blocked %}
                                <span class="badge bg-danger">Bloklangan</span>
                            {% else %}
                                <span class="badge bg-success">Faol</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
