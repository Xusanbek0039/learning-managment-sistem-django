{% extends 'accounts/admin/base_admin.html' %}

{% block title %}Xabar yuborish - Admin{% endblock %}

{% block extra_css %}
<meta name="keywords" content="Suyunov Husan, IT Creative, Django admin iOS style message form dark light responsive">
<style>

/* ===== iOS Minimal Palette ===== */
:root{
    --bg:#f5f5f7;
    --card:#ffffff;
    --text:#111;
    --muted:#6b7280;
    --border:rgba(0,0,0,.08);
    --primary:#0a84ff;
}
@media (prefers-color-scheme: dark){
    :root{
        --bg:#0b0b0c;
        --card:#1c1c1e;
        --text:#f5f5f7;
        --muted:#9ca3af;
        --border:rgba(255,255,255,.08);
    }
}

/* ===== Layout ===== */
.admin-ios{
    background:var(--bg);
    min-height:100vh;
    padding:1rem;
    color:var(--text);
}

/* ===== Back ===== */
.back-link{
    display:inline-flex;
    align-items:center;
    gap:.4rem;
    color:var(--text);
    text-decoration:none;
    font-weight:500;
    margin-bottom:.75rem;
}
.back-link:hover{opacity:.7}

/* ===== Title ===== */
.page-title{
    font-size:1.4rem;
    font-weight:700;
    margin-bottom:1rem;
}

/* ===== Card ===== */
.card{
    background:var(--card)!important;
    border-radius:14px;
    border:1px solid var(--border);
}

/* ===== Card Header ===== */
.card-header{
    background:transparent!important;
    border-bottom:1px solid var(--border);
    font-weight:600;
}

/* ===== Inputs ===== */
.form-label{
    font-weight:600;
    color:var(--text);
}
.form-control,
.form-select,
textarea{
    background:transparent;
    color:var(--text);
    border:1px solid var(--border);
    border-radius:10px;
}
.form-control:focus,
.form-select:focus,
textarea:focus{
    border-color:var(--primary);
    box-shadow:none;
}

/* ===== Button ===== */
.btn-primary{
    background:var(--primary);
    border:none;
    border-radius:10px;
}

/* ===== Tips ===== */
.tip-list{
    padding-left:1rem;
    color:var(--muted);
    font-size:.9rem;
}

/* ===== Mobile ===== */
@media(max-width:768px){
    .page-title{text-align:center;}
}

</style>
{% endblock %}

{% block admin_content %}
<div class="admin-ios">

<a href="{% url 'admin_messages' %}" class="back-link">
    <i class="bi bi-arrow-left"></i>
    Orqaga
</a>

<h1 class="page-title">
    <i class="bi bi-send me-1"></i>Xabar yuborish
</h1>

<div class="row g-3">

    <!-- FORM -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body p-4">

                <form method="POST">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">Xabar turi</label>
                        <select name="message_type" class="form-select" id="messageType" required>
                            <option value="all">Barchaga</option>
                            <option value="students">Faqat o‘quvchilarga</option>
                            <option value="teachers">Faqat o‘qituvchilarga</option>
                            <option value="personal">Shaxsiy xabar</option>
                        </select>
                    </div>

                    <div class="mb-3" id="recipientDiv" style="display:none;">
                        <label class="form-label">Qabul qiluvchi</label>
                        <select name="recipient" class="form-select">
                            <option value="">Tanlang...</option>
                            {% for user in users %}
                            <option value="{{ user.pk }}">
                                {{ user.full_name }} (@{{ user.username }})
                                — {% if user.role == 'student' %}O‘quvchi{% else %}O‘qituvchi{% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Sarlavha</label>
                        <input type="text" name="title" class="form-control" required>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Xabar matni</label>
                        <textarea name="content" class="form-control" rows="6" required></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary px-4">
                        <i class="bi bi-send me-1"></i>Yuborish
                    </button>

                </form>

            </div>
        </div>
    </div>

    <!-- INFO -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                Ma’lumot
            </div>
            <div class="card-body">
                <ul class="tip-list mb-0">
                    <li>“Barchaga” — barcha foydalanuvchilarga</li>
                    <li>“O‘quvchilarga” — faqat o‘quvchilarga</li>
                    <li>“O‘qituvchilarga” — faqat ustozlarga</li>
                    <li>“Shaxsiy” — bitta foydalanuvchiga</li>
                </ul>
            </div>
        </div>
    </div>

</div>

</div>

<script>
document.getElementById('messageType').addEventListener('change', function() {
    const recipientDiv = document.getElementById('recipientDiv');
    recipientDiv.style.display = this.value === 'personal' ? 'block' : 'none';
});
</script>
{% endblock %}
