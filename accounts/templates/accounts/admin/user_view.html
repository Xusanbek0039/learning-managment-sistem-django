{% extends 'accounts/admin/base_admin.html' %}

{% block title %}{{ user_obj.full_name }} - Admin Panel{% endblock %}

{% block admin_content %}
<a href="{% url 'admin_users' %}" class="back-link">
    <i class="bi bi-arrow-left me-2"></i>Orqaga qaytish
</a>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card text-center p-4">
            <div class="mb-3">
                {% if user_obj.photo %}
                <img src="{{ user_obj.photo.url }}" alt="{{ user_obj.full_name }}"
                    style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary-blue);">
                {% else %}
                <div
                    style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); display: flex; align-items: center; justify-content: center; margin: 0 auto; font-size: 3rem; color: white; font-weight: 700;">
                    {{ user_obj.get_initials }}
                </div>
                {% endif %}
            </div>

            <h4 style="color: var(--text-color);">{{ user_obj.full_name }}</h4>
            <p class="text-muted">@{{ user_obj.username }}</p>

            <div class="mb-3">
                <span class="badge 
                    {% if user_obj.role == 'admin' %}bg-danger
                    {% elif user_obj.role == 'teacher' %}bg-success
                    {% else %}bg-primary{% endif %}" style="font-size: 1rem; padding: 8px 20px;">
                    {% if user_obj.role == 'admin' %}Admin{% elif user_obj.role == 'teacher' %}O'qituvchi{% else
                    %}O'quvchi{% endif %}
                </span>
            </div>

            <div class="mb-3">
                <span class="coin-badge"
                    style="background: linear-gradient(135deg, #ffc107, #ff9800); color: #000; padding: 8px 20px; border-radius: 20px;">
                    <i class="bi bi-coin me-1"></i>{{ user_obj.coins }} coin
                </span>
            </div>

            <hr>

            <div class="d-grid gap-2">
                <a href="{% url 'admin_user_edit' user_obj.pk %}" class="btn btn-primary">
                    <i class="bi bi-pencil me-2"></i>Tahrirlash
                </a>
                <a href="{% url 'user_statistics' user_obj.pk %}" class="btn btn-outline-info">
                    <i class="bi bi-graph-up me-2"></i>Statistika
                </a>
                {% if user_obj.is_student %}
                <a href="{% url 'issue_certificate' user_obj.pk %}" class="btn btn-outline-success">
                    <i class="bi bi-award me-2"></i>Sertifikat berish
                </a>
                {% endif %}
                {% if not user_obj.is_admin %}
                <a href="{% url 'admin_user_block' user_obj.pk %}"
                    class="btn btn-{% if user_obj.is_blocked %}success{% else %}warning{% endif %}">
                    <i class="bi bi-{% if user_obj.is_blocked %}unlock{% else %}lock{% endif %} me-2"></i>
                    {% if user_obj.is_blocked %}Blokdan chiqarish{% else %}Bloklash{% endif %}
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header" style="background: transparent;">
                <h5 style="color: var(--text-color); margin: 0;">
                    <i class="bi bi-person-lines-fill me-2"></i>Ma'lumotlar
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted">Telefon</label>
                        <p style="color: var(--text-color);">{{ user_obj.phone }}</p>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted">Ro'yxatdan o'tgan</label>
                        <p style="color: var(--text-color);">{{ user_obj.date_joined|date:"d.m.Y H:i" }}</p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted">Yashash manzili</label>
                        <p style="color: var(--text-color);">
                            {% if user_obj.address %}{{ user_obj.address }}{% else %}-{% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted">Tug'ilgan sana</label>
                        <p style="color: var(--text-color);">
                            {% if user_obj.birth_date %}{{ user_obj.birth_date|date:"d.m.Y" }}{% else %}-{% endif %}
                        </p>
                    </div>
                </div>
                {% if user_obj.id_card or user_obj.birth_certificate %}
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted">Hujjatlar</label>
                        <div class="d-flex gap-2">
                            {% if user_obj.id_card %}
                            <a href="{{ user_obj.id_card.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                <i class="bi bi-person-badge me-1"></i>ID Karta
                            </a>
                            {% endif %}
                            {% if user_obj.birth_certificate %}
                            <a href="{{ user_obj.birth_certificate.url }}" target="_blank"
                                class="btn btn-sm btn-outline-info">
                                <i class="bi bi-file-earmark-text me-1"></i>Guvohnoma
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted">Oxirgi faollik</label>
                        <p style="color: var(--text-color);">
                            {% if user_obj.last_activity %}{{ user_obj.last_activity|date:"d.m.Y H:i" }}{% else %}-{%
                            endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted">Status</label>
                        <p>
                            {% if user_obj.is_blocked %}
                            <span class="badge bg-danger">Bloklangan</span>
                            {% elif user_obj.is_online %}
                            <span class="badge bg-success">Online</span>
                            {% else %}
                            <span class="badge bg-secondary">Offline</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        {% if certificates %}
        <div class="card">
            <div class="card-header" style="background: transparent;">
                <h5 style="color: var(--text-color); margin: 0;">
                    <i class="bi bi-award me-2"></i>Sertifikatlar
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table" style="color: var(--text-color);">
                        <thead>
                            <tr>
                                <th>Yo'nalish</th>
                                <th>Berilgan sana</th>
                                <th>Bergan</th>
                                <th>Fayl</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cert in certificates %}
                            <tr>
                                <td>{{ cert.profession.name }}</td>
                                <td>{{ cert.issued_at|date:"d.m.Y" }}</td>
                                <td>{{ cert.issued_by.full_name }}</td>
                                <td>
                                    <a href="{{ cert.file.url }}" class="btn btn-sm btn-outline-primary"
                                        target="_blank">
                                        <i class="bi bi-download"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}