{% extends 'accounts/admin/base_admin.html' %}

{% block title %}{{ user_obj.full_name }} | Admin Panel{% endblock %}

{% block admin_content %}

<a href="{% url 'admin_users' %}" class="btn btn-outline-secondary rounded-pill mb-4">
    <i class="bi bi-arrow-left me-1"></i>Orqaga
</a>

<div class="row g-4">

<!-- ================= LEFT PROFILE ================= -->
<div class="col-lg-4">

<div class="card text-center p-4 h-100">

    <!-- AVATAR -->
    <div class="mb-3">

        {% if user_obj.photo and user_obj.photo.url %}
            <img src="{{ user_obj.photo.url }}"
                 class="rounded-circle"
                 style="width:140px;height:140px;object-fit:cover;border:4px solid #6366f1;">
        {% else %}
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold mx-auto"
                 style="width:140px;height:140px;font-size:3rem;">
                {{ user_obj.get_initials }}
            </div>
        {% endif %}

    </div>

    <h4 class="fw-bold mb-0">{{ user_obj.full_name }}</h4>
    <small class="text-muted">@{{ user_obj.username }}</small>

    <!-- ROLE -->
    <div class="my-3">
        <span class="badge rounded-pill px-4 py-2
            {% if user_obj.role == 'admin' %}bg-danger
            {% elif user_obj.role == 'teacher' %}bg-success
            {% else %}bg-primary{% endif %}">
            {% if user_obj.role == 'admin' %}Admin
            {% elif user_obj.role == 'teacher' %}O‘qituvchi
            {% else %}O‘quvchi{% endif %}
        </span>
    </div>

    <!-- COINS -->
    <div class="mb-3">
        <span class="badge rounded-pill fs-6 px-4 py-2 text-dark"
              style="background:linear-gradient(135deg,#facc15,#f59e0b);">
            <i class="bi bi-coin me-1"></i>{{ user_obj.coins }} coin
        </span>
    </div>

    <hr>

    <!-- ACTIONS -->
    <div class="d-grid gap-2">

        <a href="{% url 'admin_user_edit' user_obj.pk %}" class="btn btn-primary rounded-pill">
            <i class="bi bi-pencil me-1"></i>Tahrirlash
        </a>

        <a href="{% url 'user_statistics' user_obj.pk %}" class="btn btn-outline-info rounded-pill">
            <i class="bi bi-graph-up me-1"></i>Statistika
        </a>

        {% if user_obj.is_student %}
        <a href="{% url 'issue_certificate' user_obj.pk %}" class="btn btn-outline-success rounded-pill">
            <i class="bi bi-award me-1"></i>Sertifikat berish
        </a>
        {% endif %}

        {% if not user_obj.is_admin %}
        <a href="{% url 'admin_user_block' user_obj.pk %}"
           class="btn {% if user_obj.is_blocked %}btn-success{% else %}btn-warning{% endif %} rounded-pill">
            <i class="bi bi-{% if user_obj.is_blocked %}unlock{% else %}lock{% endif %} me-1"></i>
            {% if user_obj.is_blocked %}Blokdan chiqarish{% else %}Bloklash{% endif %}
        </a>
        {% endif %}

        <a href="{% url 'admin_user_devices' user_obj.pk %}" class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-laptop me-1"></i>Qurilmalar ({{ user_obj.devices.count }})
        </a>

    </div>

</div>
</div>

<!-- ================= RIGHT INFO ================= -->
<div class="col-lg-8 d-flex flex-column gap-4">

<!-- INFO CARD -->
<div class="card p-4">

<h5 class="fw-bold mb-3">
    <i class="bi bi-person-lines-fill me-2"></i>Ma’lumotlar
</h5>

<div class="row g-3">

<div class="col-md-6">
    <small class="text-muted">Telefon</small>
    <div>{{ user_obj.phone|default:"-" }}</div>
</div>

<div class="col-md-6">
    <small class="text-muted">Ro‘yxatdan o‘tgan</small>
    <div>{{ user_obj.date_joined|date:"d.m.Y H:i" }}</div>
</div>

<div class="col-md-6">
    <small class="text-muted">Manzil</small>
    <div>{{ user_obj.address|default:"-" }}</div>
</div>

<div class="col-md-6">
    <small class="text-muted">Tug‘ilgan sana</small>
    <div>
        {% if user_obj.birth_date %}{{ user_obj.birth_date|date:"d.m.Y" }}{% else %}-{% endif %}
    </div>
</div>

{% if user_obj.id_card or user_obj.birth_certificate %}
<div class="col-12">
    <small class="text-muted">Hujjatlar</small><br>

    {% if user_obj.id_card and user_obj.id_card.url %}
        <a href="{{ user_obj.id_card.url }}" target="_blank"
           class="btn btn-sm btn-outline-info rounded-pill me-2">
            <i class="bi bi-person-badge me-1"></i>ID karta
        </a>
    {% endif %}

    {% if user_obj.birth_certificate and user_obj.birth_certificate.url %}
        <a href="{{ user_obj.birth_certificate.url }}" target="_blank"
           class="btn btn-sm btn-outline-info rounded-pill">
            <i class="bi bi-file-earmark-text me-1"></i>Guvohnoma
        </a>
    {% endif %}
</div>
{% endif %}

<div class="col-md-6">
    <small class="text-muted">Oxirgi faollik</small>
    <div>
        {% if user_obj.last_activity %}
            {{ user_obj.last_activity|date:"d.m.Y H:i" }}
        {% else %}-{% endif %}
    </div>
</div>

<div class="col-md-6">
    <small class="text-muted">Status</small><br>

    {% if user_obj.is_blocked %}
        <span class="badge bg-danger rounded-pill px-3">Bloklangan</span>
    {% elif user_obj.is_online %}
        <span class="badge bg-success rounded-pill px-3">Online</span>
    {% else %}
        <span class="badge bg-secondary rounded-pill px-3">Offline</span>
    {% endif %}
</div>

</div>
</div>

<!-- CERTIFICATES -->
{% if certificates %}
<div class="card p-4">

<h5 class="fw-bold mb-3">
    <i class="bi bi-award me-2"></i>Sertifikatlar
</h5>

<div class="table-responsive">
<table class="table table-hover align-middle">

<thead>
<tr>
    <th>Yo‘nalish</th>
    <th>Sana</th>
    <th>Bergan</th>
    <th>Fayl</th>
</tr>
</thead>

<tbody>
{% for cert in certificates %}
<tr>
    <td>{{ cert.profession.name }}</td>
    <td>{{ cert.issued_at|date:"d.m.Y" }}</td>
    <td>{{ cert.issued_by.full_name }}</td>
    <td>
        {% if cert.file and cert.file.url %}
        <a href="{{ cert.file.url }}" target="_blank"
           class="btn btn-sm btn-outline-primary rounded-pill">
            <i class="bi bi-download"></i>
        </a>
        {% endif %}
    </td>
</tr>
{% endfor %}
</tbody>

</table>
</div>

</div>
{% endif %}

</div>
</div>

{% endblock %}
