
{% block title %}AI Yordamchi | IT Creative LMS{% endblock %}

{% block content %}

<!-- SEO META -->
<meta name="keywords" content="Suyunov Husan, IT Creative, Django AI chatbot, OpenAI API, Python AI yordamchi, LMS AI">
<meta name="description" content="Django LMS ichida ishlovchi AI Yordamchi. Muallif: Suyunov Husan - IT Creative.">

<style>
.chat-container{
    max-width: 950px;
    margin: 40px auto;
}
.chat-card{
    border-radius: 18px;
    overflow: hidden;
}
.chat-header{
    background: linear-gradient(135deg,#2563eb,#7c3aed);
}
.chat-body{
    height: 480px;
    overflow-y: auto;
    background: #f8fafc;
}
.msg{
    max-width: 75%;
    padding: 12px 14px;
    border-radius: 16px;
    font-size: .95rem;
    line-height: 1.5;
}
.msg.user{
    background: #2563eb;
    color: #fff;
    border-bottom-right-radius: 4px;
}
.msg.ai{
    background: #e5e7eb;
    color: #000;
    border-bottom-left-radius: 4px;
}
.avatar{
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
}
.time{
    font-size: .7rem;
    opacity: .6;
}
</style>

<div class="chat-container">
    <div class="card shadow chat-card">

        <!-- HEADER -->
        <div class="chat-header text-white p-3 d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-0">ðŸ¤– AI Yordamchi</h5>
                <small>IT Creative LMS</small>
            </div>
            <span class="badge bg-success">Online</span>
        </div>

        <!-- BODY -->
        <div class="chat-body p-3" id="chatBox">

            {% for m in messages %}

                {% if m.role == "user" %}
                <div class="d-flex justify-content-end mb-3">
                    <div class="me-2 text-end">
                        <div class="msg user">
                            {% if m.text %}{{ m.text|linebreaksbr }}{% endif %}
                            {% if m.file %}
                                <div class="mt-2">
                                    ðŸ“Ž <a class="text-white" href="{{ m.file.url }}" target="_blank">Fayl</a>
                                </div>
                            {% endif %}
                        </div>
                        <div class="time mt-1">{{ m.created_at|date:"H:i d.m.Y" }}</div>
                    </div>
                    <img src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=2563eb&color=fff"
                         class="avatar">
                </div>
                {% else %}
                <div class="d-flex mb-3">
                    <img src="https://ui-avatars.com/api/?name=AI&background=7c3aed&color=fff"
                         class="avatar me-2">
                    <div>
                        <div class="msg ai">
                            {{ m.text|linebreaksbr }}
                        </div>
                        <div class="time mt-1">{{ m.created_at|date:"H:i d.m.Y" }}</div>
                    </div>
                </div>
                {% endif %}

            {% empty %}
                <div class="text-center text-muted mt-5">
                    <h6>ðŸ‘‹ Salom!</h6>
                    <p>Savolingni yoz va AI bilan suhbatni boshlaymiz ðŸ˜„</p>
                </div>
            {% endfor %}

        </div>

        <!-- FOOTER -->
        <div class="p-3 border-top bg-white">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="row g-2 align-items-end">

                    <div class="col-12 col-md-8">
                        {{ form.text }}
                    </div>

                    <div class="col-6 col-md-2">
                        {{ form.file }}
                        <small class="text-muted">Rasm/Fayl</small>
                    </div>

                    <div class="col-6 col-md-2 d-grid">
                        <button class="btn btn-primary">
                            Yuborish ðŸš€
                        </button>
                    </div>

                </div>
            </form>
        </div>

    </div>
</div>

<script>
const box = document.getElementById("chatBox");
box.scrollTop = box.scrollHeight;
</script>

{% endblock %}
